<html><head><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"> </script></head> <style>table {border-collapse: collapse;} th, td {border:1px solid; text-align :center}</style> <head><meta charset="UTF8"></head> <h1 align="center">Example 2: Calculate Dispersion Relation of Ion Bernstein Waves Using the SymPIC Code</h1> <h2>1 Introduction</h2> <p>Ion Bernstein waves (IBWs) are a nearly electrostatic waves that propagating perpendicular to external magnetic field. Their frequency is approximately at \(\omega_{ci}\), where \(\omega_{ci}\) is the ion cyclotron frequency, which is far lower than the cyclotron frequency of electrons. So to resolve the dispersion relation of IBWs directly using electromagnetic PIC method, a lot of timesteps are required and the long term conservation property of the algoritm becomes crucial. For more information of IBWs, section 11 of the book  <b>Waves in Plasmas</b> can be referred.</p> <h2>2 Parameter setup</h2> <p>Considering a 1D plasma, external magnetic field is at \(z\) direction, charged particles are deuteriums and electrons, the configuration file can be as follows.</p> <script> function func_mcl_1() {var x = document.getElementById("DIV_ID_1");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,249,249);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_1" onClick="event.cancelBubble=true;func_mcl_1()">(<block style="color:RGB(192,0,0);">begin</block><br>&nbsp;&nbsp;<script> function func_mcl_2() {var x = document.getElementById("DIV_ID_2");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,237,237);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_2" onClick="event.cancelBubble=true;func_mcl_2()">(<block style="color:RGB(192,0,0);">defmacro</block> <block style="color:RGB(192,0,0);">many-define</block> lst<br>&nbsp;&nbsp;(<block style="color:RGB(0,128,32);">cons</block> &apos;<block style="color:RGB(192,0,0);">begin</block> (<block style="color:RGB(0,128,32);">map</block> <script> function func_mcl_3() {var x = document.getElementById("DIV_ID_3");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,213,213);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_3" onClick="event.cancelBubble=true;func_mcl_3()">(<block style="color:RGB(192,0,0);">lambda</block> (x)<br>&nbsp;&nbsp;(<block style="color:RGB(0,128,32);">cons</block> &apos;<block style="color:RGB(192,0,0);">define</block> x))</div> lst)))</div><br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">;Define a macro to generate large mount of define statements

</block> <br><br>&nbsp;&nbsp;<script> function func_mcl_4() {var x = document.getElementById("DIV_ID_4");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,237,237);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_4" onClick="event.cancelBubble=true;func_mcl_4()">(<block style="color:RGB(192,0,0);">many-define</block><br>&nbsp;&nbsp;(REAL_DX <block style="color:RGB(192,0,192);">8.00000000000000038e-04</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">;Grid size is 8e-4m

</block> <br><br>&nbsp;&nbsp;(REAL_MU0 (<block style="color:RGB(0,128,32);">*</block> <block style="color:RGB(192,0,192);">4</block> m_pi <block style="color:RGB(192,0,192);">9.99999999999999955e-08</block>))<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">;\mu_0 in the vaccum, m_pi is a build-in constant which defines the value of pi

</block> <br><br>&nbsp;&nbsp;(REAL_NE <block style="color:RGB(192,0,192);">1.00000000000000000e+20</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">;Number density is 1e20m^-3

</block> <br><br>&nbsp;&nbsp;(REAL_ME <block style="color:RGB(192,0,192);">9.10000000000000006e-31</block>)<br>&nbsp;&nbsp;(REAL_E <block style="color:RGB(192,0,192);">1.60199999999999998e-19</block>)<br>&nbsp;&nbsp;(REAL_C <block style="color:RGB(192,0,192);">2.99792458000000000e+08</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">;Set real mass, charge of electron and light speed

</block> <br><br>&nbsp;&nbsp;(DELTAT <block style="color:RGB(192,0,192);">5.00000000000000000e-01</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Time step \Delta t = 0.5 \Delta x / c

</block> <br><br>&nbsp;&nbsp;(E (<block style="color:RGB(0,128,32);">*</block> REAL_E (<block style="color:RGB(0,128,32);">sqrt</block> (<block style="color:RGB(0,128,32);">/</block> REAL_MU0 REAL_ME REAL_DX))))<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Normalized charge of one electron

</block> <br><br>&nbsp;&nbsp;(CONST_E_DENSITY (<block style="color:RGB(0,128,32);">*</block> REAL_NE REAL_DX REAL_DX REAL_DX))<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Normalized number density

</block> <br><br>&nbsp;&nbsp;(NPG0 <block style="color:RGB(192,0,192);">256</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Number of marker particles per grid

</block> <br><br>&nbsp;&nbsp;(NPG1 NPG0)<br>&nbsp;&nbsp;(NPM0 (<block style="color:RGB(0,128,32);">/</block> CONST_E_DENSITY NPG0))<br>&nbsp;&nbsp;(NPM1 (<block style="color:RGB(0,128,32);">/</block> CONST_E_DENSITY NPG1))<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Number of real particles represented by each marker particle

</block> <br><br>&nbsp;&nbsp;(XMAX <block style="color:RGB(192,0,192);">8</block>)<br>&nbsp;&nbsp;(YMAX <block style="color:RGB(192,0,192);">1</block>)<br>&nbsp;&nbsp;(ZMAX <block style="color:RGB(192,0,192);">1</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set dimension (number of grids) for each computing unit

</block> <br><br>&nbsp;&nbsp;(NUM_N_HILBERT <block style="color:RGB(192,0,192);">7</block>)<br>&nbsp;&nbsp;(NUM_N_HILBERT_DIMENSION <block style="color:RGB(192,0,192);">1</block>)<br>&nbsp;&nbsp;(HILBERT_DIR <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set the order of Hilbert space filling curve to 7, dimension to 1, direction to 0 (x), the total simulation mesh is 1024x1x1

</block> <br><br>&nbsp;&nbsp;(NUM_SPEC <block style="color:RGB(192,0,192);">2</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Number of species is 2

</block> <br><br>&nbsp;&nbsp;(NUM_TIMESTEP <block style="color:RGB(192,0,192);">1000001</block>)<br>&nbsp;&nbsp;(NUM_DUMP_TIMESTEP <block style="color:RGB(192,0,192);">16</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Number of timesteps is 1000000, outputs every 16 time steps

</block> <br><br>&nbsp;&nbsp;(gen_simulate_B <script> function func_mcl_5() {var x = document.getElementById("DIV_ID_5");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_5" onClick="event.cancelBubble=true;func_mcl_5()">(<block style="color:RGB(192,0,0);">lambda</block> (x)<br>&nbsp;&nbsp;(runc <block style="color:RGB(224,0,192)">&quot;x/(E*REAL_C/REAL_DX*REAL_ME/REAL_E)&quot;</block>))</div>)<br>&nbsp;&nbsp;(gen_simulate_E <script> function func_mcl_6() {var x = document.getElementById("DIV_ID_6");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_6" onClick="event.cancelBubble=true;func_mcl_6()">(<block style="color:RGB(192,0,0);">lambda</block> (x)<br>&nbsp;&nbsp;(runc <block style="color:RGB(224,0,192)">&quot;x/(E*REAL_C*REAL_C/REAL_DX*REAL_ME/REAL_E)&quot;</block>))</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; gen_simulate_B and gen_simulate_E are used to generate normalized electromagnetic fields, runc is a macro which converts conventional math expressions to s-expressions

</block> <br><br>&nbsp;&nbsp;(USE_INIT_EXT_EB <block style="color:RGB(192,0,192);">1</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; This case need to use external electromagnetic fields

</block> <br><br>&nbsp;&nbsp;(B0 (gen_simulate_B <block style="color:RGB(192,0,192);">2.50000000000000000e+00</block>))<br>&nbsp;&nbsp;(Bvec (<block style="color:RGB(0,128,32);">vector</block> <block style="color:RGB(192,0,192);">0</block> <block style="color:RGB(192,0,192);">0</block> B0))<br>&nbsp;&nbsp;(GET_INIT_B <script> function func_mcl_7() {var x = document.getElementById("DIV_ID_7");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_7" onClick="event.cancelBubble=true;func_mcl_7()">(<block style="color:RGB(192,0,0);">lambda</block> (z y x l)<br>&nbsp;&nbsp;(<block style="color:RGB(0,128,32);">vector-ref</block> Bvec l))</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; The external magnetic field is [0,0,2.5T]

</block> <br><br>&nbsp;&nbsp;(GET_INIT_E <script> function func_mcl_8() {var x = document.getElementById("DIV_ID_8");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_8" onClick="event.cancelBubble=true;func_mcl_8()">(<block style="color:RGB(192,0,0);">lambda</block> (z y x l)<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; The external electric field is 0

</block> <br><br>&nbsp;&nbsp;(USE_CHECKPOINT <block style="color:RGB(192,0,192);">1</block>)<br>&nbsp;&nbsp;(NUM_CHECKPOINT_TIMESTEP <block style="color:RGB(192,0,192);">10000</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Use checkpoint, and output checkpoint every 10000 timesteps

</block> <br><br>&nbsp;&nbsp;(NUM_PROCESS <block style="color:RGB(192,0,192);">4</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set the total number of MPI processes to 4

</block> <br><br>&nbsp;&nbsp;(NUM_MAX_RUNTIME <block style="color:RGB(192,0,192);">1</block>)<br>&nbsp;&nbsp;(NUM_RUNTIME <block style="color:RGB(192,0,192);">1</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set number of runtimes to 1

</block> <br><br>&nbsp;&nbsp;(GET_DEV_TYPE <script> function func_mcl_9() {var x = document.getElementById("DIV_ID_9");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_9" onClick="event.cancelBubble=true;func_mcl_9()">(<block style="color:RGB(192,0,0);">lambda</block> (x r)<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">1</block>)</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Use runtime id to 1, which is OpenMP in this case

</block> <br><br>&nbsp;&nbsp;(GET_DEV_ID <script> function func_mcl_10() {var x = document.getElementById("DIV_ID_10");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_10" onClick="event.cancelBubble=true;func_mcl_10()">(<block style="color:RGB(192,0,0);">lambda</block> (x r)<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set the device id to 0

</block> <br><br>&nbsp;&nbsp;(E_0 <block style="color:RGB(192,0,192);">-1</block>)<br>&nbsp;&nbsp;(M_0 <block style="color:RGB(192,0,192);">1</block>)<br>&nbsp;&nbsp;(E_1 <block style="color:RGB(192,0,192);">1</block>)<br>&nbsp;&nbsp;(M_1 <block style="color:RGB(192,0,192);">3672</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set relative charge and mass of the 0th and 1st particles

</block> <br><br>&nbsp;&nbsp;(GET_MASS <script> function func_mcl_11() {var x = document.getElementById("DIV_ID_11");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_11" onClick="event.cancelBubble=true;func_mcl_11()">(<block style="color:RGB(192,0,0);">lambda</block> (i)<br>&nbsp;&nbsp;(<block style="color:RGB(192,0,0);">case</block> i (<block style="color:RGB(192,0,192);">0</block> (<block style="color:RGB(0,128,32);">*</block> M_0 NPM0)) (<block style="color:RGB(192,0,192);">1</block> (<block style="color:RGB(0,128,32);">*</block> M_1 NPM1)) (<block style="color:RGB(192,0,0);">else</block> <block style="color:RGB(192,0,192);">1</block>)))</div>)<br>&nbsp;&nbsp;(GET_CHARGE <script> function func_mcl_12() {var x = document.getElementById("DIV_ID_12");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_12" onClick="event.cancelBubble=true;func_mcl_12()">(<block style="color:RGB(192,0,0);">lambda</block> (i)<br>&nbsp;&nbsp;(<block style="color:RGB(192,0,0);">case</block> i (<block style="color:RGB(192,0,192);">0</block> (<block style="color:RGB(0,128,32);">*</block> E_0 E NPM0)) (<block style="color:RGB(192,0,192);">1</block> (<block style="color:RGB(0,128,32);">*</block> E_1 E NPM1)) (<block style="color:RGB(192,0,0);">else</block> <block style="color:RGB(192,0,192);">0</block>)))</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set the mass and charge of 0th and 1st marker particles to M_0*NPM0, M_1*NPM1, E_0*E*NPM0, E_1*E*NPM1, respectively

</block> <br><br>&nbsp;&nbsp;(USE_INIT_EB0 <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Do not use initial condition of electromagnetic fields, in this case they are all set to 0

</block> <br><br>&nbsp;&nbsp;(USE_FILTER <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Do not use filters for electromagnetic fields

</block> <br><br>&nbsp;&nbsp;(USE_NON_UNI_DENSITY <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Do not use non uniformly distributed particles

</block> <br><br>&nbsp;&nbsp;(USE_NON_UNI_TEMPERATURE <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Do not use non uniformly distributed temperatures

</block> <br><br>&nbsp;&nbsp;(USE_INIT_V0 <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Do not use drift Maxwell distributed particles

</block> <br><br>&nbsp;&nbsp;(GET_GRID_CACHE_LEN <script> function func_mcl_13() {var x = document.getElementById("DIV_ID_13");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_13" onClick="event.cancelBubble=true;func_mcl_13()">(<block style="color:RGB(192,0,0);">lambda</block> (i)<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">320</block>)</div>)<br>&nbsp;&nbsp;(GET_CU_CACHE_LEN <script> function func_mcl_14() {var x = document.getElementById("DIV_ID_14");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_14" onClick="event.cancelBubble=true;func_mcl_14()">(<block style="color:RGB(192,0,0);">lambda</block> (i)<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">4096</block>)</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set grid cache and compute unit cache

</block> <br><br>&nbsp;&nbsp;(GET_INIT_LOAD <script> function func_mcl_15() {var x = document.getElementById("DIV_ID_15");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_15" onClick="event.cancelBubble=true;func_mcl_15()">(<block style="color:RGB(192,0,0);">lambda</block> (i)<br>&nbsp;&nbsp;(<block style="color:RGB(192,0,0);">case</block> i (<block style="color:RGB(192,0,192);">0</block> NPG0) (<block style="color:RGB(192,0,192);">1</block> NPG1) (<block style="color:RGB(192,0,0);">else</block> NPG0)))</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set number of particles per grid initially

</block> <br><br>&nbsp;&nbsp;(GET_INIT_VT <script> function func_mcl_16() {var x = document.getElementById("DIV_ID_16");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_16" onClick="event.cancelBubble=true;func_mcl_16()">(<block style="color:RGB(192,0,0);">lambda</block> (i)<br>&nbsp;&nbsp;(<block style="color:RGB(192,0,0);">case</block> i (<block style="color:RGB(192,0,192);">0</block> <block style="color:RGB(192,0,192);">4.37999999999999987e-02</block>) (<block style="color:RGB(192,0,192);">1</block> <block style="color:RGB(192,0,192);">7.22800000000000005e-04</block>) (<block style="color:RGB(192,0,0);">else</block> <block style="color:RGB(192,0,192);">0</block>)))</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Set thermal velocities for i-th particles

</block> <br><br>&nbsp;&nbsp;(GET_VAR <script> function func_mcl_17() {var x = document.getElementById("DIV_ID_17");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_17" onClick="event.cancelBubble=true;func_mcl_17()">(<block style="color:RGB(192,0,0);">lambda</block> (s)<br>&nbsp;&nbsp;(<block style="color:RGB(192,0,0);">define</block> s1 (<block style="color:RGB(0,128,32);">string-&gt;symbol</block> s))<br>&nbsp;&nbsp;<script> function func_mcl_18() {var x = document.getElementById("DIV_ID_18");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,207,207);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_18" onClick="event.cancelBubble=true;func_mcl_18()">(<block style="color:RGB(192,0,0);">if</block> (symbol-binded? s1)<br>&nbsp;&nbsp;(<block style="color:RGB(0,128,32);">eval</block> (<block style="color:RGB(0,128,32);">string-&gt;symbol</block> s))<br>&nbsp;&nbsp;<script> function func_mcl_19() {var x = document.getElementById("DIV_ID_19");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,195,195);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_19" onClick="event.cancelBubble=true;func_mcl_19()">(<block style="color:RGB(192,0,0);">begin</block><br>&nbsp;&nbsp;(write-string (multi-concat <block style="color:RGB(224,0,192)">&quot;Warning: symbol &quot;</block> s1 <block style="color:RGB(224,0,192)">&quot; is unbounded\n&quot;</block>) current-error-port)<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)</div>)</div>)<br>&nbsp;&nbsp;(CAL_FUN_ONE_PARA <script> function func_mcl_20() {var x = document.getElementById("DIV_ID_20");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_20" onClick="event.cancelBubble=true;func_mcl_20()">(<block style="color:RGB(192,0,0);">lambda</block> (s x)<br>&nbsp;&nbsp;(<block style="color:RGB(192,0,0);">define</block> s1 (<block style="color:RGB(0,128,32);">string-&gt;symbol</block> s))<br>&nbsp;&nbsp;<script> function func_mcl_21() {var x = document.getElementById("DIV_ID_21");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,207,207);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_21" onClick="event.cancelBubble=true;func_mcl_21()">(<block style="color:RGB(192,0,0);">if</block> (symbol-binded? s1)<br>&nbsp;&nbsp;((<block style="color:RGB(0,128,32);">eval</block> (<block style="color:RGB(0,128,32);">string-&gt;symbol</block> s)) x)<br>&nbsp;&nbsp;<script> function func_mcl_22() {var x = document.getElementById("DIV_ID_22");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,195,195);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_22" onClick="event.cancelBubble=true;func_mcl_22()">(<block style="color:RGB(192,0,0);">begin</block><br>&nbsp;&nbsp;(write-string (multi-concat <block style="color:RGB(224,0,192)">&quot;Warning: symbol &quot;</block> s1 <block style="color:RGB(224,0,192)">&quot; is unbounded\n&quot;</block>) current-error-port)<br>&nbsp;&nbsp;(<block style="color:RGB(0,128,32);">car</block> <block style="color:RGB(192,0,192);">0</block>))</div>)</div>)</div>)<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Those two functions are used to dynamically load variables and one-parameter functions

</block> <br><br>&nbsp;&nbsp;(opi (<block style="color:RGB(0,128,32);">sqrt</block> (<block style="color:RGB(0,128,32);">/</block> (<block style="color:RGB(0,128,32);">*</block> E E CONST_E_DENSITY) M_1)))<br>&nbsp;&nbsp;(ope (<block style="color:RGB(0,128,32);">sqrt</block> (<block style="color:RGB(0,128,32);">/</block> (<block style="color:RGB(0,128,32);">*</block> E E CONST_E_DENSITY) M_0)))<br>&nbsp;&nbsp;(oci (<block style="color:RGB(0,128,32);">/</block> (<block style="color:RGB(0,128,32);">*</block> B0 E) M_1))<br>&nbsp;&nbsp;(oce (<block style="color:RGB(0,128,32);">/</block> (<block style="color:RGB(0,128,32);">*</block> B0 E) M_0))<br>&nbsp;&nbsp;(lhw_freq (pow (<block style="color:RGB(0,128,32);">+</block> (pow (<block style="color:RGB(0,128,32);">*</block> oci oce) <block style="color:RGB(192,0,192);">-1</block>) (pow opi <block style="color:RGB(192,0,192);">-2</block>)) <block style="color:RGB(192,0,192);">-5.00000000000000000e-01</block>))<br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; calculate normalized omega_{pi}, omega_{pe}, omega_{ci}, omega_{ce} and lower hybrid frequency

</block> <br><br>&nbsp;&nbsp;<block style="color:RGB(108,108,108)">; Rest are non-related parameters

</block> <br><br>&nbsp;&nbsp;(GET_INIT_V0_x <script> function func_mcl_23() {var x = document.getElementById("DIV_ID_23");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_23" onClick="event.cancelBubble=true;func_mcl_23()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(GET_INIT_V0_y <script> function func_mcl_24() {var x = document.getElementById("DIV_ID_24");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_24" onClick="event.cancelBubble=true;func_mcl_24()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(GET_INIT_V0_z <script> function func_mcl_25() {var x = document.getElementById("DIV_ID_25");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_25" onClick="event.cancelBubble=true;func_mcl_25()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(GET_INIT_FILTER_KROOK <script> function func_mcl_26() {var x = document.getElementById("DIV_ID_26");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_26" onClick="event.cancelBubble=true;func_mcl_26()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(GET_INIT_FILTER_E <script> function func_mcl_27() {var x = document.getElementById("DIV_ID_27");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_27" onClick="event.cancelBubble=true;func_mcl_27()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(GET_INIT_FILTER_B <script> function func_mcl_28() {var x = document.getElementById("DIV_ID_28");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_28" onClick="event.cancelBubble=true;func_mcl_28()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(GET_INIT_E0 <script> function func_mcl_29() {var x = document.getElementById("DIV_ID_29");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_29" onClick="event.cancelBubble=true;func_mcl_29()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(GET_INIT_B0 <script> function func_mcl_30() {var x = document.getElementById("DIV_ID_30");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_30" onClick="event.cancelBubble=true;func_mcl_30()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(GET_INIT_TEMPERATURE_DIST <script> function func_mcl_31() {var x = document.getElementById("DIV_ID_31");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_31" onClick="event.cancelBubble=true;func_mcl_31()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(USE_KGM <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;(USE_DM <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;(USE_TORI <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;(USE_PROFILE <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;(USE_LHCD_INPUT <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;(USE_NON_UNI_CACHE_DIST <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;(GET_NUM_LOCAL_THREAD_FROM_GLOBAL_TID <script> function func_mcl_32() {var x = document.getElementById("DIV_ID_32");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_32" onClick="event.cancelBubble=true;func_mcl_32()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;x)</div>)<br>&nbsp;&nbsp;(GET_NPM <script> function func_mcl_33() {var x = document.getElementById("DIV_ID_33");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_33" onClick="event.cancelBubble=true;func_mcl_33()">(<block style="color:RGB(192,0,0);">lambda</block> (i)<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">1</block>)</div>)<br>&nbsp;&nbsp;(USE_NP_BOUNDARY <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;(USE_NON_UNI_CACHE_DIST <block style="color:RGB(192,0,192);">0</block>)<br>&nbsp;&nbsp;(GET_NON_UNI_CACHE_DIST <script> function func_mcl_34() {var x = document.getElementById("DIV_ID_34");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_34" onClick="event.cancelBubble=true;func_mcl_34()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>)<br>&nbsp;&nbsp;(GET_INIT_DENSITY_DIST <script> function func_mcl_35() {var x = document.getElementById("DIV_ID_35");if (x.style.height == "") {x.style.height="1.5em";} else {x.style.height="";}} </script><div style="overflow:hidden;margin-left:20px;background-color:RGB(255,219,219);border-style:solid;border-color: RGB(128,192,192);border-width:thin thin thin thin;" id="DIV_ID_35" onClick="event.cancelBubble=true;func_mcl_35()">(<block style="color:RGB(192,0,0);">lambda</block> x<br>&nbsp;&nbsp;<block style="color:RGB(192,0,192);">0</block>)</div>))</div>)</div> <h2>3 Executing</h2> <p> When the sympic is running, the environment variable STDLIB should be set to the location of stdlib.scm. So under the root directory of SymPIC, executing the following commands:</p> <div style="color:RGB(0,255,0);background-color:RGB(24,24,24);font-family:monospace;"><block>$ export STDLIB=$PWD/stdlib.scm</block> <br> <block>$ 	export SYMPIC_DIR=$PWD</block> <br> 	</div> <p>In a new directory, save the configuration file specified in the Section 2 to ibw.ss. Suppose we have a cpu with 8 core and 16 threads, then using the following command to run:</p> <div style="color:RGB(0,255,0);background-color:RGB(24,24,24);font-family:monospace;"><block>$ export OMP_NUM_THREADS=4</block> <br> <block>$ 	   mpirun -n 4 $SYMPIC_DIR/sympic ibw.ss</block> <br> 	   </div> <p> It will take a long time if your CPU is not that powerful. Don&apos;t worry about interruption, we have specified that the checkpoint will be automatically generated every 10000 timesteps, just rerun the command and it will automatically use the last saved checkpoint. If you want to change the number of MPI processes, NUM_PROCESS in the ibw.ss should be also changed. After it finishes, three files named tmpEN, tmpEB and tmpJ are generated, we may see the dispersion relation using the matplotlib.</p> <div style="color:RGB(0,255,0);background-color:RGB(24,24,24);font-family:monospace;"><block>$ ipython --pylab</block> <br> </div> <p> In the terminal of ipython, using the following command to obtain the dispersion relation:</p> <div style="color:RGB(0,255,0);background-color:RGB(24,24,24);font-family:monospace;"><block> In [1]: execfile(&apos;path-to-SymPIC-dir/cgapsio/pygapsio.py&apos;);</block> <br> <block> </block> <br> <block> 	      In [2]: Ex=GAPS_IO_Load(&apos;tmpEB&apos;)[::2,0,0,:,0];</block> <br> <block> </block> <br> <block> 	      In [3]: ftEx=fftn(average(reshape(Ex[:-1,:],[6250,10,1024]),axis=1));</block> <br> <block> </block> <br> <block> 	      In [4]: contour(abs(ftEx)[:300,:256],20);</block> <br> 	      </div> <p>If everything is right, the dispersion relation of IBWs and magnetosonic wave will be shown.</p> <img src="dispibw.png" width="540px"> <p>To check the energy conservation property, we may use the following command in the pylab terminal.</p> <div style="color:RGB(0,255,0);background-color:RGB(24,24,24);font-family:monospace;"><block> In [5]: EB=GAPS_IO_Load (&apos;tmpEB&apos;) [:-2,0,0,:,:];</block> <br> <block> </block> <br> <block> 		 In [6]: eneEB=sum(EB**2/2, axis=(-2,-1));</block> <br> <block> </block> <br> <block> 		 In [7]: eneEB=eneEB [::2]+eneEB [1::2];</block> <br> <block> </block> <br> <block> 		 In [8]: eneEI=GAPS_IO_Load (&apos;tmpEN&apos;);</block> <br> <block> </block> <br> <block> 		 In [9]: eneE=sum(eneEI [:-1,0,0,:,:3], axis=(-2,-1));</block> <br> <block> </block> <br> <block> 		 In [10]: eneI=sum(eneEI [:-1,0,0,:,7:10], axis=(-2,-1));</block> <br> <block> </block> <br> <block> 		 In [11]: figure ();plot (eneEB+eneE+eneI);</block> <br> 		 </div> <p>It is clear that the error of total energy is bounded as we expected.</p> <img src="eneibw.png" width="540px"></html>